/*! Zenith v1.0.0-alpha.0 | MIT License | Â© 2022 Aleph1 Technologies Inc */
let e=0;const t=new Map,o=Object.freeze({math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"}),r=Object.keys(o).join(","),n={},s=Object.freeze({}),a=new Map,l=new Map,d=(e,t)=>{const o=t.flat(1/0),r=o[0],n=!(!r||"boolean"==typeof r||2!==r.type&&4!==r.type||!Object.prototype.hasOwnProperty.call(r.attrs,"key"));for(const[e,t]of o.entries())if(t&&"boolean"!=typeof t){if((2===t.type||4===t.type)&&n!==Object.prototype.hasOwnProperty.call(t.attrs,"key"))throw new Error("children must be keyed or keyless")}else o[e]=null;return o},c=(e,t,o)=>{const r=e+":"+(t||"")+":"+(o||"");return(n[r]||(n[r]=t?document.createElementNS(t,e,o?{is:o}:null):document.createElement(e,o?{is:o}:null))).cloneNode()},m=(e,t,o,r)=>{if(null!=o&&null!=o.dom){const n=t.type,s=o.type;if(t.parent=e,n===s)switch(n){case 2:if(t.tag!==o.tag){const n=4===e.type?e.doms.indexOf(o.dom):-1;g(e,t,r),o.dom.replaceWith(t.dom),j(e,o),-1!==n&&(e.doms[n]=t.dom)}else t.dom=o.dom,b(e,t,o,r);break;case 3:t.dom=o.dom,t.tag!==o.tag&&t.dom.replaceWith(t.dom=document.createTextNode(t.tag));break;case 4:t.tag!==o.tag?(j(e,o),g(e,t,r)):(t.dom=o.dom,t.doms=o.doms,t.children=o.children,k(e,t,r));break;case 5:t.tag!==o.tag?(j(e,o),g(e,t,r)):(t.dom=o.dom,t.doms=o.doms)}else j(e,o),g(e,t,r)}else g(e,t,r)},i=(e,t,o,r)=>{const n=t.length,s=o.length;if(n>0)if(s>0){let a;const l=[],d=t[0]&&t[0].attrs&&Object.prototype.hasOwnProperty.call(t[0].attrs,"key")&&null!=t[0].attrs.key,c=o[0]&&o[0].attrs&&Object.prototype.hasOwnProperty.call(o[0].attrs,"key")&&null!=o[0].attrs.key;if(d&&c){const n={},s={};for(const e of t)n[e.attrs.key]=!0;for(const t of o){const o=t.attrs.key;n[o]?s[o]=t:(j(e,t),delete s[o])}for(const o of t)null!=o&&(m(e,o,s[o.attrs.key],r),l.push(o.dom),o.dom.remove());f(e.dom,l)}else{const l=new Set;for(let r=n;r<s;r++)a=o[r],j(e,a),!0===a.removing&&(a.parent=e,t[r]=a);for(let s=0;s<n;s++)a=o[s],null==t[s]&&null!=a?(j(e,a),!0===a.removing&&(a.parent=e,t[s]=a,l.add(t[s].dom))):null==a||null==a.dom||l.has(a.dom)?(g(e,t[s],r),l.add(t[s].dom)):null==a.removing&&(m(e,t[s],a,r),l.add(t[s].dom))}}else p(e,t,0,n,r);else v(e,o,0,s);e.children=t},p=(e,t,o,r,n)=>{for(;o<r;)g(e,t[o++],n)},f=(e,t)=>{for(const o of t)o&&e.appendChild(o)},g=(e,t,o)=>{if(null!=t)switch(t.parent=e,t.type){case 2:h(e,t,o),f(e.dom,[t.dom]);break;case 3:t.dom=document.createTextNode(t.tag),f(e.dom,[t.dom]);break;case 4:w(e,t,o),f(e.dom,t.doms);break;case 5:y(e,t,o),f(e.dom,t.doms)}},y=(e,t,o)=>{t.dom=c(e.dom.nodeName,o),t.dom.innerHTML=t.tag,t.doms=[...t.dom.childNodes]},u=(e,t,o,r,n)=>{if(null!=o&&"type"!==t&&"key"!==t&&"is"!==t&&"ns"!==t)if("class"===t)e.dom.setAttribute(t,Array.isArray(o)?o.join(" "):o);else if("style"===t)if("string"==typeof o)e.dom.setAttribute(t,o);else for(const t in o)e.dom.style[t]=o[t];else"value"===t?"input"!==e.tag&&"option"!==e.tag&&"textarea"!==e.tag||(e.dom.value=o+""):"boolean"==typeof o?!0===o?e.dom.setAttribute(t,t):e.dom.removeAttribute(t):"o"===t[0]&&"n"===t[1]?e.events[t]=e.dom[t]=o:e.dom.setAttribute(t,o)},h=(e,t,r)=>{t.events={},t.dom=c(t.tag,r=((e,t)=>e.attrs&&e.attrs.xmlns||o[e.tag]||t)(t,t.attrs.ns||r),t.attrs.is),t.attrs.tick&&l.set(t,t.attrs.tick),"input"===t.tag&&null!=t.attrs.type&&t.dom.setAttribute("type",t.attrs.type);for(const e in t.attrs)u(t,e,t.attrs[e]);p(t,t.children,0,t.children.length,r)},b=(e,t,o,r)=>{t.events=o.events,"input"===t.tag&&null!=t.attrs.type&&t.dom.setAttribute("type",t.attrs.type);for(const e in o.attrs)"o"===e[0]&&"n"===e[1]?t.events[e]=t.dom[e]=null:"type"!==e&&t.dom.removeAttribute(e);for(const e in t.attrs)u(t,e,t.attrs[e],o.attrs[e]);i(t,t.children,o.children,r)},w=(e,t,o)=>{t.tag.init&&t.tag.init(t),t.dom=c(e.dom.nodeName,o),t.children=A(t,t.tag.draw),p(t,t.children,0,t.children.length,o),t.doms=[...t.dom.childNodes],t.tag.tick&&l.set(t,t.tag.tick),t.tag.drawn&&t.tag.drawn(t)},k=(e,t,o)=>{i(t,A(t,t.tag.draw,t.children),t.children,o||t.dom.namespaceURI),t.tag.drawn&&t.tag.drawn(t)},v=(e,t,o,r,n)=>{for(;o<r;)j(e,t[o++],n)},O=e=>{if(4===e.type&&(e.tag.destroy&&e.tag.destroy(e),e.removing=null),e.children?(v(e,e.children,0,e.children.length,!0),e.children.length=0):e.dom&&e.dom.remove&&e.dom.remove(),e.doms)for(const t of e.doms)t.remove();else e.dom&&e.dom.remove&&e.dom.remove();delete e.dom,e.parent=null},j=(e,t,o)=>{if(null!=t){let e=!0;switch(t.type){case 2:t.attrs.tick&&l.delete(t);break;case 4:if(t.tag.tick&&l.delete(t),!0===t.removing)e=!1;else if(!0!==o&&"function"==typeof t.tag.remove){const o=t.tag.remove(t);if(null!=o&&"function"==typeof o.then){e=!1,t.removing=!0;const r=()=>{t.removing=!1,t.parent.children.splice(t.parent.children.indexOf(t),1),O(t)};o.then(r,r)}}break;case 5:for(const e in t.doms)t.doms[e].remove()}e&&O(t)}},A=(e,t,o)=>{const r=t(e,o);return d(0,Array.isArray(r)?r:[r])},N=(e,...t)=>{const o=[];let r=0,n=t[r];for(!n||"object"!=typeof n||null!=n.tag||Array.isArray(n)?n=s:(n=Object.freeze(Object.assign({},n)),r++);r<t.length;){const e=t[r++];o.push(null!=e&&"object"==typeof e?e:null)}const a={type:2,tag:e,attrs:n};return a.children=d(0,o),a},x=(e,t)=>a.set(t,[e]),E=()=>{e++;for(const[e,t]of a)4===e.type&&k(t[0],e,t[1]);a.clear();for(const[t,o]of l)o(t,e);requestAnimationFrame(E)};E();
const text = e=>{const t=typeof e;return{type:3,tag:"string"===t||"number"===t||"bigint"===t?e+"":""}};
export {N as elem, text};