/*! Zenith v1.0.0-alpha.5 | MIT License | Â© 2022 Aleph1 Technologies Inc */
const z=function(){"use strict";let e=0;const t=new Map,r=new Map,o=Object.freeze({math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"}),n={},s=Object.freeze({}),a=e=>{const t=e.flat(1/0),r=t[0],o=null!=r&&"boolean"!=typeof r&&(2===r.type||4===r.type)&&"key"in r.attrs;for(const[e,r]of t.entries())if(null==r||"boolean"==typeof r)t[e]=null;else if((2===r.type||4===r.type)&&o!=="key"in r.attrs)throw new Error("children must be keyed or keyless");return t},d=e=>e.closest(o[(e.closest("math,svg")||e).nodeName.toLowerCase()]),l=e=>{const t=[];for(const r of e)null!=r&&(4===r.type||6===r.type?t.push(...r.doms):t.push(r.dom));return t},m=(e,t,r)=>{const o=e+":"+(t||"")+":"+(r||"");return(n[o]||(n[o]=t?document.createElementNS(t,e,r?{is:r}:null):document.createElement(e,r?{is:r}:null))).cloneNode()},i=(e,t,r)=>{if(null!=t&&t.parentNode===e)for(const o of r)o&&e.insertBefore(o,t);else for(const t of r)t&&e.appendChild(t)},c=(e,t,r)=>{null==t?e.appendChild(r):e.insertBefore(r,t)},f=(e,t,r,o,n,s,a)=>{if(null!=n&&null!=n.dom){o.parent=n.parent,o.root=n.root;const s=o.type;if(s===n.type)switch(s){case 2:o.tag!==n.tag?(h(e,t,n.dom,o),j(e,n)):w(e,t,r,o,n,a);break;case 3:o.tag!==n.tag?(o.dom=document.createTextNode(o.tag),c(t,n.dom,o.dom),n.dom.remove()):o.dom=n.dom;break;case 4:o.tag!==n.tag?(h(e,t,r,o,a),j(e,n)):(o.dom=n.dom,o.doms=n.doms,o.children=n.children,k(e,t,r,o,a));break;case 6:o.tag!==n.tag?(h(e,t,r,o,a),j(e,n)):(o.dom=n.dom,o.doms=n.doms);break;case 5:o.dom!==n.dom&&(c(t,n.dom,o.dom),n.dom.remove())}else h(e,t,r,o,a),j(e,n)}else h(e,t,r,o,a)},u=(e,t,r,o,n,s)=>{const a=o.length,d=n.length;if(a>0)if(d>0){let l,m;const c=[],u=o[0]&&o[0].attrs&&null!=o[0].attrs.key,p=n[0]&&n[0].attrs&&null!=n[0].attrs.key;if(!0===u&&!0===p){const a={},d={};for(m of o)a[m.attrs.key]=!0;for(l of n){const t=l.attrs.key;a[t]?d[t]=l:(j(e,l),delete d[t])}let u=0;for(m of o)null!=m&&(f(e,t,r,m,d[m.attrs.key],0,s),4===m.type||6===m.type?c.push(...m.doms):c.push(m.dom)),u++;i(t,null,c)}else{const i=new Set;for(let t=a;t<d;t++)l=n[t],!1===j(e,l)&&(l.parent=e,l.root=e.root,o[t]=l);for(let d=0;d<a;d++)l=n[d],m=o[d],null==m?null!=l&&!1===j(e,l)&&(l.parent=e,l.root=e.root,o[d]=m=l,m&&i.add(o[d].dom)):null==l||null==l.dom||i.has(l.dom)?(h(e,t,r,m,s),m&&i.add(m.dom)):null==l.removed&&(f(e,t,r,m,l,0,s),m&&i.add(m.dom))}}else p(e,t,r,o,0,a,s);else N(e,n,0,d);e.children=o},p=(e,t,r,o,n,s,a)=>{for(;n<s;)h(e,t,r,o[n++],a)},h=(e,t,r,o,n)=>{if(null!=o)switch(o.parent=e,o.root=e.root,o.type){case 2:y(e,t,r,o,n);break;case 3:o.dom=document.createTextNode(o.tag),c(t,r,o.dom);break;case 4:b(e,t,r,o,n);break;case 6:v(e,t,r,o,n);break;case 5:c(t,r,o.dom)}},g=(e,t,r,o,n)=>{if(null!=r&&"type"!==t&&"key"!==t&&"is"!==t&&"ns"!==t)if("value"===t)e.dom.value=r+"";else if(!0===r)e.dom.setAttribute(t,t);else if(!1===r)e.dom.removeAttribute(t);else if("o"===t[0]&&"n"===t[1])e.events[t]=e.dom[t]=r;else if(Array.isArray(r))e.dom.setAttribute(t,r.join(" "));else if("object"==typeof r)for(const o in r)e.dom[t][o]=r[o];else e.dom.setAttribute(t,r)},y=(e,t,n,s,a)=>{s.events={},s.dom=m(s.tag,a=((e,t)=>e.attrs&&e.attrs.xmlns||o[e.tag]||t)(s,s.attrs.ns||a),s.attrs.is),s.attrs.tick&&r.set(s,s.attrs.tick),"input"===s.tag&&null!=s.attrs.type&&s.dom.setAttribute("type",s.attrs.type);for(const e in s.attrs)g(s,e,s.attrs[e]);p(s,s.dom,n,s.children,0,s.children.length,a),c(t,n,s.dom)},w=(e,t,r,o,n,s)=>{o.dom=n.dom,o.events=n.events,"input"===o.tag&&null!=o.attrs.type&&o.dom.setAttribute("type",o.attrs.type);for(const e in n.attrs)"o"===e[0]&&"n"===e[1]?o.events[e]=o.dom[e]=null:"type"!==e&&o.dom.removeAttribute(e);for(const e in o.attrs)g(o,e,o.attrs[e],n.attrs[e]);u(o,o.dom,r,o.children,n.children,s)},b=(e,t,o,n,s)=>{n.tag.init&&n.tag.init(n);const a=n.children=O(n,n.tag.draw);p(n,t,o,a,0,a.length,s),n.doms=l(n.children),n.dom=n.doms[0],i(t,o,n.doms),n.tag.drawn&&n.tag.drawn(n),n.tag.tick&&r.set(n,n.tag.tick)},k=(e,t,r,o,n)=>{u(o,t,r,O(o,o.tag.draw,o.children),o.children,n||o.dom.namespaceURI),o.doms=l(o.children),o.dom=o.doms[0],o.tag.drawn&&o.tag.drawn(o)},v=(e,t,r,o,n)=>{const s=m(t.nodeName,n);s.innerHTML=o.tag,o.doms=[...s.childNodes],o.dom=o.doms[0],i(t,r,o.doms)},A=e=>{if(4===e.type&&e.tag.destroy&&e.tag.destroy(e),e.children?(N(e,e.children,0,e.children.length,!0),e.children.length=0):e.dom&&e.dom.remove(),e.doms)for(const t of e.doms)t.remove();else e.dom&&e.dom.remove();delete e.dom,e.root=e.parent=null},N=(e,t,r,o,n)=>{for(;r<o;)j(e,t[r++],n)},j=(e,t,o)=>{if(null!=t){switch(t.type){case 2:t.attrs.tick&&r.delete(t);break;case 4:if(t.tag.tick&&r.delete(t),!0===t.removed)return!1;if(!0!==o&&"function"==typeof t.tag.remove){const e=t.tag.remove(t);if(t.removed=!0,e){if(e instanceof Promise){const r=()=>{t&&(t.root&&(t.root.redraw=!0),t.parent&&t.parent.children.splice(t.parent.children.indexOf(t),1)),A(t)};return e.then(r,r),!1}throw new Error("comp.destroy must return falsy or Promise")}}break;case 6:for(const e in t.doms)t.doms[e].remove()}return A(t),!0}},O=(e,t,r)=>{const o=t(e,r);return a(Array.isArray(o)?o:[o])},E=()=>{e++;for(const[t,o]of r)o(t,e);for(const[e,r]of t)!0===r.redraw&&(r.redraw=!1,u(r,e,null,r.children,r.children,d(e)));requestAnimationFrame(E)};E();return{elem:(e,...t)=>{const r=[];let o=0,n=t[o];for(!n||"object"!=typeof n||null!=n.tag||Array.isArray(n)?n=s:(n=Object.freeze(Object.assign({},n)),o++);o<t.length;){const e=t[o++];r.push(null!=e&&"object"==typeof e?e:null)}return{type:2,tag:e,attrs:n,children:a(r)}},text:e=>{const t=typeof e;return{type:3,tag:"string"===t||"number"===t||"bigint"===t?e+"":""}},comp:(e,t)=>{const r={type:4,tag:e,attrs:t?Object.freeze(t):s,draw:e=>{e?k(r.parent,r.parent.dom,((e,t,r)=>{for(;t<r;){if(null!=e[t]&&null!=e[t].dom)return e[t].dom;t++}})(r.parent.children,r.parent.children.indexOf(r)+1,r.parent.children.length),r):r.root.redraw=!0}};return r},node:e=>({type:5,tag:e.nodeName.toLowerCase(),attrs:s,dom:e}),html:e=>{const t=typeof e;return{type:6,tag:"string"===t||"number"===t||"bigint"===t?e+"":""}},compDef:e=>{if("function"!=typeof e.draw)throw new Error("compDef requires draw function");return Object.assign({},e,{type:7})},mount:(e,r)=>{if(null==e)throw new Error("dom must be an Element");let o=e.parentNode;for(;o;){if(t.get(o))throw new Error("dom ancestor is already drawn");o=o.parentNode}const n=t.get(e)||t.set(e,{type:1,tag:e.nodeName.toLowerCase(),attrs:s,dom:e,children:[]}).get(e);return null==r||0===r.length?(N(n,n.children,0,n.children.length),n.children.length=0,t.delete(e)):(n.root=n,u(n,e,null,a(Array.isArray(r)?r:[r]),n.children,d(e))),n},type:Object.freeze({none:0,compDef:7,comp:4,elem:2,html:6,node:5,text:3}),ns:o}}();