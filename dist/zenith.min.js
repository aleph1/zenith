/*! Zenith v1.0.0-alpha.0 | MIT License | Â© 2022 Aleph1 Technologies Inc */
const z=function(){"use strict";let e=0;const t=new Map,o=Object.freeze({math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"}),r={},n=Object.freeze({}),s=new Map,a=new Map,d=(e,t)=>{const o=t.flat(1/0),r=o[0],n=!(!r||"boolean"==typeof r||2!==r.type&&4!==r.type||!("key"in r.attrs));for(const[e,t]of o.entries())if(t&&"boolean"!=typeof t){if((2===t.type||4===t.type)&&n!=="key"in t.attrs)throw new Error("children must be keyed or keyless")}else o[e]=null;return o},l=(e,t,o)=>{const n=e+":"+(t||"")+":"+(o||"");return(r[n]||(r[n]=t?document.createElementNS(t,e,o?{is:o}:null):document.createElement(e,o?{is:o}:null))).cloneNode()},i=(e,t,o,r)=>{if(null!=o&&null!=o.dom){const n=t.type,s=o.type;if(t.parent=e,n===s)switch(n){case 2:if(t.tag!==o.tag){const n=4===e.type?e.doms.indexOf(o.dom):-1;g(e,t,r),o.dom.replaceWith(t.dom),A(e,o),-1!==n&&(e.doms[n]=t.dom)}else t.dom=o.dom,y(e,t,o,r);break;case 3:t.dom=o.dom,t.tag!==o.tag&&t.dom.replaceWith(t.dom=document.createTextNode(t.tag));break;case 4:t.tag!==o.tag?(A(e,o),g(e,t,r)):(t.dom=o.dom,t.doms=o.doms,t.children=o.children,w(e,t,r));break;case 5:t.tag!==o.tag?(A(e,o),g(e,t,r)):(t.dom=o.dom,t.doms=o.doms)}else A(e,o),g(e,t,r)}else g(e,t,r)},m=(e,t,o,r)=>{const n=t.length,s=o.length;if(n>0)if(s>0){let a;const d=[],l=t[0]&&t[0].attrs&&null!=t[0].attrs.key,m=o[0]&&o[0].attrs&&null!=o[0].attrs.key;if(l&&m){const n={},s={};for(const e of t)n[e.attrs.key]=!0;for(const t of o){const o=t.attrs.key;n[o]?s[o]=t:(A(e,t),delete s[o])}for(const o of t)null!=o&&(i(e,o,s[o.attrs.key],r),d.push(o.dom),o.dom.remove());f(e.dom,d)}else{const d=new Set;for(let r=n;r<s;r++)a=o[r],A(e,a),!0===a.removing&&(a.parent=e,t[r]=a);for(let s=0;s<n;s++)a=o[s],null==t[s]&&null!=a?(A(e,a),!0===a.removing&&(a.parent=e,t[s]=a,t[s]&&d.add(t[s].dom))):null==a||null==a.dom||d.has(a.dom)?(g(e,t[s],r),t[s]&&d.add(t[s].dom)):null==a.removing&&(i(e,t[s],a,r),t[s]&&d.add(t[s].dom))}}else c(e,t,0,n,r);else v(e,o,0,s);e.children=t},c=(e,t,o,r,n)=>{for(;o<r;)g(e,t[o++],n)},f=(e,t)=>{for(const o of t)o&&e.appendChild(o)},g=(e,t,o)=>{if(null!=t)switch(t.parent=e,t.type){case 2:h(e,t,o),f(e.dom,[t.dom]);break;case 3:t.dom=document.createTextNode(t.tag),f(e.dom,[t.dom]);break;case 4:b(e,t,o),f(e.dom,t.doms);break;case 5:u(e,t,o),f(e.dom,t.doms)}},u=(e,t,o)=>{t.dom=l(e.dom.nodeName,o),t.dom.innerHTML=t.tag,t.doms=[...t.dom.childNodes]},p=(e,t,o,r,n)=>{if(null!=o&&"type"!==t&&"key"!==t&&"is"!==t&&"ns"!==t)if("class"===t)e.dom.setAttribute(t,Array.isArray(o)?o.join(" "):o);else if("style"===t)if("string"==typeof o)e.dom.setAttribute(t,o);else for(const t in o)e.dom.style[t]=o[t];else"value"===t?"input"!==e.tag&&"option"!==e.tag&&"textarea"!==e.tag||(e.dom.value=o+""):"boolean"==typeof o?!0===o?e.dom.setAttribute(t,t):e.dom.removeAttribute(t):"o"===t[0]&&"n"===t[1]?e.events[t]=e.dom[t]=o:e.dom.setAttribute(t,o)},h=(e,t,r)=>{t.events={},t.dom=l(t.tag,r=((e,t)=>e.attrs&&e.attrs.xmlns||o[e.tag]||t)(t,t.attrs.ns||r),t.attrs.is),t.attrs.tick&&a.set(t,t.attrs.tick),"input"===t.tag&&null!=t.attrs.type&&t.dom.setAttribute("type",t.attrs.type);for(const e in t.attrs)p(t,e,t.attrs[e]);c(t,t.children,0,t.children.length,r)},y=(e,t,o,r)=>{t.events=o.events,"input"===t.tag&&null!=t.attrs.type&&t.dom.setAttribute("type",t.attrs.type);for(const e in o.attrs)"o"===e[0]&&"n"===e[1]?t.events[e]=t.dom[e]=null:"type"!==e&&t.dom.removeAttribute(e);for(const e in t.attrs)p(t,e,t.attrs[e],o.attrs[e]);m(t,t.children,o.children,r)},b=(e,t,o)=>{t.tag.init&&t.tag.init(t),t.dom=l(e.dom.nodeName,o),t.children=N(t,t.tag.draw),c(t,t.children,0,t.children.length,o),t.doms=[...t.dom.childNodes],t.tag.tick&&a.set(t,t.tag.tick),t.tag.drawn&&t.tag.drawn(t)},w=(e,t,o)=>{m(t,N(t,t.tag.draw,t.children),t.children,o||t.dom.namespaceURI),t.tag.drawn&&t.tag.drawn(t)},v=(e,t,o,r,n)=>{for(;o<r;)A(e,t[o++],n)},k=e=>{if(4===e.type&&(e.tag.destroy&&e.tag.destroy(e),e.removing=null),e.children?(v(e,e.children,0,e.children.length,!0),e.children.length=0):e.dom&&e.dom.remove&&e.dom.remove(),e.doms)for(const t of e.doms)t.remove();else e.dom&&e.dom.remove&&e.dom.remove();delete e.dom,e.parent=null},A=(e,t,o)=>{if(null!=t){switch(t.type){case 2:t.attrs.tick&&a.delete(t);break;case 4:if(t.tag.tick&&a.delete(t),!0===t.removing)return;if(!0!==o&&"function"==typeof t.tag.remove){const e=t.tag.remove(t);if(null!=e&&"function"==typeof e.then){t.removing=!0;const o=()=>{t.removing=!1,t.parent.children.splice(t.parent.children.indexOf(t),1),k(t)};return void e.then(o,o)}}break;case 5:for(const e in t.doms)t.doms[e].remove()}k(t)}},N=(e,t,o)=>{const r=t(e,o);return d(0,Array.isArray(r)?r:[r])},j=(e,...t)=>{const o=[];let r=0,s=t[r];for(!s||"object"!=typeof s||null!=s.tag||Array.isArray(s)?s=n:(s=Object.freeze(Object.assign({},s)),r++);r<t.length;){const e=t[r++];o.push(null!=e&&"object"==typeof e?e:null)}const a={type:2,tag:e,attrs:s};return a.children=d(0,o),a},O=(e,t)=>s.set(t,[e]),x=()=>{e++;for(const[e,t]of s)4===e.type&&w(t[0],e,t[1]);s.clear();for(const[t,o]of a)o(t,e);requestAnimationFrame(x)};x();return{elem:j,text:e=>{const t=typeof e;return{type:3,tag:"string"===t||"number"===t||"bigint"===t?e+"":""}},comp:(e,t)=>{const o={type:4,tag:e,redraw:e=>((e,t)=>{t?w(e.parent,e):O(e.parent,e)})(o,e),attrs:t?Object.freeze(t):n};return o},html:e=>{const t=typeof e;return{type:5,tag:"string"===t||"number"===t||"bigint"===t?e+"":""}},compDef:e=>{if("function"!=typeof e.draw)throw new Error("compDef requires draw function");return Object.assign({},e,{type:1})},mount:(e,r)=>{if(null==e)throw new Error("dom must be an Element");let n=e.parentNode;for(;n;){if(t.get(n))throw new Error("dom ancestor is already drawn");n=n.parentNode}const s=t.get(e)||t.set(e,Object.assign(j(e.nodeName.toLowerCase()),{dom:e})).get(e);return null==r||0===r.length?(v(s,s.children,0,s.children.length),s.children.length=0):m(s,d(0,Array.isArray(r)?r:[r]),s.children,(e=>e.closest(o[(e.closest("math,svg")||e).nodeName.toLowerCase()]))(e)),s},type:Object.freeze({none:0,compDef:1,elem:2,text:3,comp:4,html:5}),ns:o}}();